<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:replace="fragments/fragment :: headerFragment('Tambah Pegawai')"></title>
    <object th:include="fragments/fragment :: css" th:remove="tag"></object>
    <object th:include="fragments/fragment :: js" th:remove="tag"></object>
    <script th:src="@{/js/jquery-3.3.1.min.js}"></script>
</head>
<body>
<nav th:replace="fragments/fragment :: navbar"></nav>
	<br>
	<div class="container-fluid">
		<h2>Tambah Pegawai</h2>
		<form th:action="@{/pegawai/tambah}" th:object="${pegawai}" method="POST" id="tambahPegawai">
			<table>
				<tr>
					<td style>Nama</td>
					<td><input type="text" name="nama" class="form-control" required="required" th:value="*{nama}"/></td>
				</tr>
				<tr>
					<td>Tempat Lahir</td>
					<td><input type="text" name="tempatLahir" class="form-control" required="required" th:value="*{tempatLahir}"/></td>
				</tr>
				<tr>
					<td>Tanggal Lahir</td>
					<td><input type="date" name="tanggalLahir" class="form-control" required="required" th:value="*{tanggalLahir}"/></td>
				</tr>
				<tr>
					<td>Tahun Masuk</td>
					<td><input type="number" name="tahunMasuk" class="form-control" required="required" th:value="*{tahunMasuk}" /></td>
				</tr>
				<tr>
					<td>Provinsi</td>
					<td>
						<span th:if="*{instansi} == null">
							<select  class="form-control" required="required" name="provinsi" id="provinsi" th:value="${allProvinsi}">
								<option disabled="disabled" selected="selected" th:value="0">Pilih Provinsi</option>
					      		<option th:each="provinsi : ${allProvinsi}" th:value="${provinsi.id}" th:text="${provinsi.nama}" ></option>
					    	</select>
						</span>
						<span th:unless="*{instansi} == null">
							<select  class="form-control" required="required" name="provinsi" id="provinsi" th:value="*{instansi.provinsi}">
					      		<option  th:value="*{instansi.provinsi.id}" selected="selected" th:text="*{instansi.provinsi.nama}"></option>
		                    	<option th:each="provinsi : ${allProvinsi}" th:value="${provinsi.id}" th:text="${provinsi.nama}" ></option>
					    	</select>
						</span>
					</td>
				</tr>
							
				<tr>
					<td>Nama Instansi</td>
					<td>
						<span th:if="*{instansi} == null">
							<select class="custom-select" th:field="*{instansi}" id="instansi" required="required">
								<option disabled="disabled" selected="selected" th:value="0">Pilih Instansi</option>
  	 							<option th:each="instansi : ${allInstansi}" th:value="${instansi.id}" th:text="${instansi.nama}" ></option>
							</select>	
						</span>
						<span th:unless="*{instansi} == null">
							<select class="custom-select" th:field="*{instansi}" id="instansi" name="instansi" required="required">
		                    	<option th:value="*{instansi.id}" selected="selected" th:text="*{instansi.nama}"></option>
		                    	<option th:each="instansi : ${allInstansi}" th:value="${instansi.id}" th:text="${instansi.nama}" ></option>
		                	</select>	
						</span>
					</td>
				</tr>
				
				<tr th:each="jabatan, iterationStat : *{jabatanList}">
					<td th:text="'Jabatan '+${iterationStat.count}"></td>
				 	<td>						
						<select class="custom-select" name="jabatanList">
							<option th:each="jabatan : ${allJabatan}" th:field="*{jabatanList[__${iterationStat.index}__]}" th:value="${jabatan.id}" th:text="${jabatan.nama}"></option>
						</select>
					</td>
					<td><button type="submit" class="btn btn-danger btn-sm" name="deleteRow" th:value="${iterationStat.index}" th:style="${iterationStat.count} == 1 ? 'display: none;' : ''">Hapus</button>												</td>
				
				</tr>	
				
				<tr>
					<td></td>
					<td>
						<button type="submit" name="addRow">Tambah Jabatan Lainnya</button>
					</td>
				</tr>
			</table>
			<br>
			<button type="submit" class="btn btn-primary">Simpan</button>
		</form>
	</div>
</body>

<script th:inline="javascript">
	$('#provinsi').change(
		function() {
			$.getJSON("http://localhost:8080/pegawai/instansi", {
			    provinsiId : $(this).val(),
			    ajax : 'true'
			}, function(data) {
			    var html = '<option disabled="disabled" selected="selected" value="0">Pilih Instansi</option>';
			    for ( var i = 0; i < data.length; i++) {
			        html += '<option value="' + data[i].id + '">'+ data[i].nama + '</option>';
			    }
			    html += '</option>';
			    $('#instansi').html(html);
			});
     });
	
	$('#instansi').change(
			function() {
				$.getJSON("http://localhost:8080/pegawai/provinsi", {
				    instansiId : $(this).val(),
				    ajax : 'true'
				}, function(data) {
				    var html = '<option value="">Pilih Provinsi</option>';
				    for ( var i = 0; i < data.length; i++) {
				        html += '<option value="' + data[i].id + '">'+ data[i].nama + '</option>';
				    }
				    html += '</option>';
				    $('#provinsi').html(html);
				});
	     });
</script>

</html>